<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdGuardHome使用指南 - AdGuardHome用户管理系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fontawesome/all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fontawesome/brands.css') }}">
    <style>
        .guide-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .guide-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .guide-nav {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .guide-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .guide-nav a {
            color: #495057;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .guide-nav a:hover {
            background: #007bff;
            color: white;
        }
        .guide-section {
            background: white;
            margin-bottom: 25px;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .guide-section h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .guide-section h3 {
            color: #495057;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        .step-list {
            counter-reset: step-counter;
        }
        .step-item {
            counter-increment: step-counter;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 5px;
        }
        .step-item::before {
            content: "步骤 " counter(step-counter) ": ";
            font-weight: bold;
            color: #007bff;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .info-box {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        .feature-card h4 {
            color: #28a745;
            margin-bottom: 10px;
        }
        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: none;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="apple-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <svg class="brand-icon" viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                <span>AdGuard Home</span>
            </div>
            <button class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-menu" id="navMenu">
                <a href="{{ url_for('main.index') }}" class="nav-link">主页</a>
                <a href="{{ url_for('main.clients') }}" class="nav-link">客户端</a>
                <a href="{{ url_for('main.guide') }}" class="nav-link">指南</a>
                <a href="{{ url_for('main.donation') }}" class="nav-link">支持</a>
                {% if current_user.is_admin %}
                <a href="{{ url_for('admin.index') }}" class="nav-link">管理后台</a>
                {% endif %}
                <a href="{{ url_for('auth.logout') }}" class="nav-link">退出</a>
            </div>
        </div>
    </nav>
    
    <div class="main-container">
        
        <main class="main-content">
            <div class="guide-container">
                <div class="guide-header">
                    <h1><i class="fas fa-shield-alt"></i> AdGuardHome使用指南</h1>
                    <p>全面了解如何使用AdGuardHome进行网络广告拦截和DNS过滤</p>
                </div>
                
                <div class="guide-nav">
                    <ul>
                        <li><a href="#overview"><i class="fas fa-info-circle"></i> 概述</a></li>
                        <li><a href="#setup"><i class="fas fa-cog"></i> 设置指南</a></li>
                        <li><a href="#features"><i class="fas fa-star"></i> 功能介绍</a></li>

                        <li><a href="#faq"><i class="fas fa-question-circle"></i> 常见问题</a></li>
                    </ul>
                </div>
                
                <section id="overview" class="guide-section">
                    <h2><i class="fas fa-info-circle"></i> AdGuardHome概述</h2>
                    <p>AdGuardHome是一个网络级别的广告和跟踪器拦截DNS服务器。它可以保护您家中的所有设备，无需在每个设备上安装客户端软件。</p>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4><i class="fas fa-shield-alt"></i> 广告拦截</h4>
                            <p>拦截网页、应用程序和游戏中的广告</p>
                        </div>
                        <div class="feature-card">
                            <h4><i class="fas fa-eye-slash"></i> 隐私保护</h4>
                            <p>阻止跟踪器和分析脚本保护您的隐私</p>
                        </div>
                        <div class="feature-card">
                            <h4><i class="fas fa-child"></i> 家长控制</h4>
                            <p>阻止成人内容和不适宜的网站</p>
                        </div>
                        <div class="feature-card">
                            <h4><i class="fas fa-chart-line"></i> 统计分析</h4>
                            <p>查看详细的DNS查询统计和分析</p>
                        </div>
                    </div>
                </section>
                
                <section id="setup" class="guide-section">
                    <h2><i class="fas fa-cog"></i> DNS设置指南</h2>
                    
                    <div class="info-box">
                        <strong><i class="fas fa-info-circle"></i> 重要说明：</strong>
                        现代DNS支持加密协议，推荐使用DoT（DNS over TLS）或DoH（DNS over HTTPS）以获得更好的安全性和隐私保护。
                    </div>
                    
                    <h3>1. DNS协议类型介绍</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4><i class="fas fa-shield-alt"></i> DoT专线（推荐安卓）</h4>
                            <p><strong>DNS over TLS协议</strong></p>
                            <ul>
                                <li>✅ 安卓/鸿蒙系统原生支持</li>
                                <li>✅ iOS/Mac系统原生支持</li>
                                <li>❌ PC浏览器需要软件支持</li>
                                <li>❌ Windows系统需要第三方软件</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4><i class="fas fa-globe"></i> DoH专线（推荐iOS）</h4>
                            <p><strong>DNS over HTTPS协议</strong></p>
                            <ul>
                                <li>❌ 安卓/鸿蒙需要第三方软件</li>
                                <li>✅ iOS/Mac原生支持</li>
                                <li>✅ PC浏览器原生支持</li>
                                <li>✅ Windows 11原生支持</li>
                            </ul>
                        </div>
                    </div>
                    
                    <h3>2. 各系统配置教程</h3>
                    
                    <h4><i class="fab fa-android"></i> Android系统配置</h4>
                    <div class="step-list">
                        <div class="step-item">
                            <strong>方法一：私人DNS设置（推荐DoT）</strong>
                            <br>打开"设置" → "连接" → "更多连接设置" → "私人DNS"
                        </div>
                        <div class="step-item">
                            选择"私人DNS提供商主机名"
                        </div>
                        <div class="step-item">
                            {% if dns_config and dns_config.dot_enabled and dns_config.dot_server %}
                                {% if user_client_id %}
                                    输入DoT服务器地址：<code>{{ user_client_id }}.{{ dns_config.dot_server }}</code>
                                {% else %}
                                    输入DoT服务器地址：<code>{{ dns_config.dot_server }}</code>
                                {% endif %}
                            {% else %}
                                输入DoT服务器地址（请联系管理员获取）
                            {% endif %}
                        </div>
                        <div class="step-item">
                            点击"保存"完成设置
                        </div>
                        <div class="step-item">
                            <img src="{{ url_for('static', filename='Android.jpg') }}" alt="Android DNS设置示例" style="max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px;">
                        </div>
                    </div>
                    
                    <div class="step-list">
                        <div class="step-item">
                            <strong>方法二：Wi-Fi DNS设置</strong>
                            <br>打开"设置" → "Wi-Fi" → 长按已连接的网络
                        </div>
                        <div class="step-item">
                            选择"修改网络" → "高级选项"
                        </div>
                        <div class="step-item">
                            将IP设置改为"静态"
                        </div>
                        <div class="step-item">
                            在DNS1字段输入AdGuardHome服务器IP地址
                        </div>
                        <div class="step-item">
                            <img src="{{ url_for('static', filename='WIFI.jpg') }}" alt="WIFI DNS设置示例" style="max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px;">
                        </div>
                    </div>
                    
                    <h4><i class="fab fa-apple"></i> iOS/iPadOS系统配置</h4>
                    <div class="step-list">
                        <div class="step-item">
                            <strong>方法一：DNS描述文件（推荐DoH）</strong>
                            {% if dns_config and dns_config.apple_config_enabled %}
                                {% if dns_config.doh_enabled and dns_config.doh_server and dns_config.apple_doh_config_enabled %}
                                    <br>下载并安装DNS配置描述文件：
                                    <a href="/api/apple/doh.mobileconfig?host={{ dns_config.doh_server }}" class="btn btn-sm btn-primary" download>
                                        <i class="fas fa-download"></i> 下载DoH配置文件
                                    </a>
                                {% elif dns_config.dot_enabled and dns_config.dot_server and dns_config.apple_dot_config_enabled %}
                                    <br>下载并安装DNS配置描述文件：
                                    {% set dot_host = dns_config.dot_server.split('.', 1)[1] if '.' in dns_config.dot_server else dns_config.dot_server %}
                                    <a href="/api/apple/dot.mobileconfig?host={{ dot_host }}" class="btn btn-sm btn-primary" download>
                                        <i class="fas fa-download"></i> 下载DoT配置文件
                                    </a>
                                {% else %}
                                    <br>下载并安装DNS配置描述文件（管理员已禁用配置文件下载功能）
                                {% endif %}
                            {% else %}
                                <br>下载并安装DNS配置描述文件（管理员已禁用苹果设备配置文件下载功能）
                            {% endif %}
                        </div>
                        <div class="step-item">
                            打开"设置" → "通用" → "VPN与设备管理"
                        </div>
                        <div class="step-item">
                            点击下载的描述文件并安装
                        </div>
                        <div class="step-item">
                            在"设置" → "通用" → "关于本机" → "证书信任设置"中启用证书
                        </div>
                    </div>
                    
                    <div class="step-list">
                        <div class="step-item">
                            <strong>方法二：Wi-Fi DNS设置</strong>
                            <br>打开"设置" → "Wi-Fi"
                        </div>
                        <div class="step-item">
                            点击已连接Wi-Fi网络旁的"ⓘ"图标
                        </div>
                        <div class="step-item">
                            点击"配置DNS" → "手动"
                        </div>
                        <div class="step-item">
                            删除现有DNS服务器，添加AdGuardHome服务器IP
                        </div>
                    </div>
                    
                    <h4><i class="fab fa-windows"></i> Windows系统配置</h4>
                    <div class="step-list">
                        <div class="step-item">
                            <strong>Windows 11（原生DoH支持）</strong>
                            <br>打开"设置" → "网络和Internet" → "以太网"或"Wi-Fi"
                        </div>
                        <div class="step-item">
                            点击网络连接 → "DNS服务器分配" → "编辑"
                        </div>
                        <div class="step-item">
                            选择"手动" → 启用"IPv4"
                        </div>
                        <div class="step-item">
                            {% if dns_config and dns_config.doh_enabled and dns_config.doh_server %}
                                输入DNS服务器地址：<code>{{ dns_config.get_doh_config_string(user_client_id) }}</code>，并启用"通过HTTPS的DNS"
                            {% else %}
                                输入DNS服务器地址，并启用"通过HTTPS的DNS"
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="step-list">
                        <div class="step-item">
                            <strong>Windows 10及以下（使用YogaDNS软件）</strong>
                            <br>下载并安装YogaDNS软件：<a href="https://yogadns.com/" target="_blank">https://yogadns.com/</a>
                        </div>
                        <div class="step-item">
                            启动软件，选择"通过空白模板创建DNS服务"
                        </div>
                        <div class="step-item">
                            点击"DNS Server" → "Add"添加新的DNS服务
                        </div>
                        <div class="step-item">
                            {% if dns_config and dns_config.doh_enabled and dns_config.doh_server %}
                                选择"DNS over HTTPS"协议，输入DoH服务器地址：<code>{{ dns_config.get_doh_config_string(user_client_id) }}</code>
                            {% else %}
                                选择"DNS over HTTPS"协议，输入DoH服务器地址
                            {% endif %}
                        </div>
                        <div class="step-item">
                            点击"Check"测试连接，然后"OK"保存并启动服务
                        </div>
                    </div>
                    
                    <h4><i class="fab fa-apple"></i> macOS系统配置</h4>
                    <div class="step-list">
                        <div class="step-item">
                            <strong>系统偏好设置方法</strong>
                            <br>打开"系统偏好设置" → "网络"
                        </div>
                        <div class="step-item">
                            选择当前网络连接 → "高级" → "DNS"标签
                        </div>
                        <div class="step-item">
                            点击"+"号添加DNS服务器地址
                        </div>
                        <div class="step-item">
                            点击"好"保存设置
                        </div>
                    </div>
                    
                    <h4><i class="fas fa-chrome"></i> 浏览器配置（Chrome/Edge）</h4>
                    <div class="step-list">
                        <div class="step-item">
                            <strong>Chrome浏览器DoH设置</strong>
                            <br>打开Chrome → "设置" → "隐私设置和安全性" → "安全"
                        </div>
                        <div class="step-item">
                            找到"使用安全DNS"选项
                        </div>
                        <div class="step-item">
                            {% if dns_config and dns_config.doh_enabled and dns_config.doh_server %}
                                选择"使用自定义"，输入DoH服务器地址：<code>{{ dns_config.get_doh_config_string(user_client_id) }}</code>
                            {% else %}
                                选择"使用自定义"，输入DoH服务器地址
                            {% endif %}
                        </div>
                        <div class="step-item">
                            保存设置，重启浏览器生效
                        </div>
                    </div>
                    
                    <h3>3. 路由器级别配置（推荐）</h3>
                    <div class="step-list">
                        <div class="step-item">
                            <strong>优势：</strong>一次配置，全家设备自动生效
                        </div>
                        <div class="step-item">
                            访问路由器管理界面（通常是192.168.1.1或192.168.0.1）
                        </div>
                        <div class="step-item">
                            进入"网络设置" → "DNS设置"或"DHCP设置"
                        </div>
                        <div class="step-item">
                            将主DNS服务器设置为AdGuardHome服务器IP地址
                        </div>
                        <div class="step-item">
                            保存设置并重启路由器
                        </div>
                    </div>
                    
                    <div class="warning-box">
                        <strong><i class="fas fa-exclamation-triangle"></i> 注意事项：</strong>
                        <ul>
                            <li>配置前请记录原有DNS设置，以便出现问题时恢复</li>
                            {% if not (dns_config and (dns_config.dot_enabled or dns_config.doh_enabled)) %}
                            <li>如果不确定服务器地址，请联系管理员获取</li>
                            {% endif %}
                            <li>建议优先使用加密DNS协议（DoT/DoH）以提高安全性</li>
                            <li>配置完成后，请访问DNS检测页面验证是否生效</li>
                        </ul>
                    </div>
                </section>
                

                
                <section id="features" class="guide-section">
                    <h2><i class="fas fa-star"></i> 功能介绍</h2>
                    
                    <h3>过滤设置</h3>
                    <ul>
                        <li><strong>广告过滤：</strong>启用后会拦截广告和跟踪器</li>
                        <li><strong>安全浏览：</strong>保护免受恶意软件和钓鱼网站</li>
                        <li><strong>家长控制：</strong>阻止成人内容和不适宜的网站</li>
                        <li><strong>安全搜索：</strong>在搜索引擎中启用安全搜索模式</li>
                    </ul>
                    
                    <h3>阻止服务</h3>
                    <p>您可以选择阻止特定的在线服务，如：</p>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4><i class="fab fa-facebook"></i> 社交媒体</h4>
                            <p>Facebook, Twitter, Instagram等</p>
                        </div>
                        <div class="feature-card">
                            <h4><i class="fas fa-video"></i> 视频平台</h4>
                            <p>YouTube, Netflix, TikTok等</p>
                        </div>
                        <div class="feature-card">
                            <h4><i class="fas fa-gamepad"></i> 游戏平台</h4>
                            <p>Steam, Epic Games等</p>
                        </div>
                        <div class="feature-card">
                            <h4><i class="fas fa-shopping-cart"></i> 购物网站</h4>
                            <p>Amazon, eBay等</p>
                        </div>
                    </div>
                    

                </section>
                

                
                <section id="faq" class="guide-section">
                    <h2><i class="fas fa-question-circle"></i> 常见问题</h2>
                    
                    <h3>Q: AdGuardHome会影响网络速度吗？</h3>
                    <p>A: 正常情况下不会。AdGuardHome通过拦截广告和跟踪器，实际上可能会提高网页加载速度。如果配置了快速的上游DNS服务器，DNS解析速度也会很快。</p>
                    
                    <h3>Q: 可以在移动网络下使用吗？</h3>
                    <p>A: 可以，但需要配置VPN或使用DNS over HTTPS (DoH)等技术。具体配置方法请咨询管理员。</p>
                    
                    <h3>Q: 如何知道AdGuardHome是否正在工作？</h3>
                    <p>A: 您可以访问DNS检测页面来验证AdGuardHome是否正常工作：</p>
                    <ul>
                        <li><a href="http://test.dns.con:5000/dns-test" target="_blank">DNS检测页面</a></li>
                    </ul>
                    <p>检测页面显示生效就代表AdGuardHome正在正常工作。管理员也可以在后台查看查询日志和统计信息。</p>
                    
                    <h3>Q: 可以为不同设备设置不同的过滤策略吗？</h3>
                    <p>A: 可以。通过客户端管理功能，您可以为每个设备创建独立的配置，包括不同的过滤级别和阻止服务。</p>
                    
                    <h3>Q: 如果某个网站被误拦截怎么办？</h3>
                    <p>A: 您可以联系管理员将该网站添加到白名单，或者临时禁用过滤功能访问该网站。</p>
                    
                    <h3>Q: AdGuardHome支持IPv6吗？</h3>
                    <p>A: 支持。AdGuardHome可以处理IPv4和IPv6的DNS查询，确保在双栈网络环境中正常工作。</p>
                    
                    <div class="warning-box">
                        <strong><i class="fas fa-info-circle"></i> 需要帮助？</strong>
                        如果您有其他问题或需要技术支持，请联系系统管理员。
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <button class="back-to-top" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    <script>
        // 返回顶部按钮
        window.onscroll = function() {
            const backToTop = document.querySelector('.back-to-top');
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                backToTop.style.display = 'block';
            } else {
                backToTop.style.display = 'none';
            }
        };
        
        function scrollToTop() {
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
        }
        
        // 平滑滚动到锚点
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // 导航菜单控制
        const navToggle = document.getElementById('navToggle');
        const navMenu = document.getElementById('navMenu');
        
        if (navToggle && navMenu) {
            navToggle.addEventListener('click', function() {
                navToggle.classList.toggle('active');
                navMenu.classList.toggle('active');
            });
            
            // 点击菜单项后关闭菜单
            const navLinks = navMenu.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    navToggle.classList.remove('active');
                    navMenu.classList.remove('active');
                });
            });
            
            // 点击页面其他地方关闭菜单
            document.addEventListener('click', function(e) {
                if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
                    navToggle.classList.remove('active');
                    navMenu.classList.remove('active');
                }
            });
        }
    </script>
</body>
</html>