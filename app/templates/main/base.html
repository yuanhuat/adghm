<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ seo_config.title if seo_config else project_name + '用户管理系统' }}{% endblock %}</title>
    
    <!-- SEO Meta Tags -->
    {% include 'components/seo_meta.html' %}
    
    <!-- 基础样式 -->
    <link href="{{ url_for('static', filename='vendor/bootstrap/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='vendor/fontawesome/all.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='vendor/fontawesome/brands.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
    
    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='vendor/jquery/jquery-3.6.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/bootstrap/bootstrap.bundle.min.js') }}"></script>
    
    <!-- 页面特定样式 -->
    {% block page_styles %}{% endblock %}
    

</head>
<body>
    <!-- 导航栏 -->
    <nav class="apple-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <svg class="brand-icon" viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                <span>{{ project_name }}</span>
            </div>
            <button class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-menu" id="navMenu">
                <a href="{{ url_for('main.dashboard') }}" class="nav-link">主页</a>
                
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-toggle">服务</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="{{ url_for('main.clients') }}">客户端</a>
                        <a class="dropdown-item" href="{{ url_for('main.guide') }}">指南</a>
                        <a class="dropdown-item" href="http://test.dns.con/dns-test" target="_blank">DNS检测</a>
                        <a class="dropdown-item" href="{{ url_for('main.sdk_redeem') }}">SDK兑换</a>
                    </div>
                </div>
                
                {% if current_user.is_authenticated and current_user.is_vip() %}
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-toggle">影视</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="{{ url_for('main.movies') }}">注册</a>
                        <a class="dropdown-item" href="{{ url_for('main.movies_guide') }}">使用方法</a>
                    </div>
                </div>
                {% else %}
                <a href="#" class="nav-link" onclick="showVipRequiredAlert(event)">影视</a>
                {% endif %}
                
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-toggle">社区</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="{{ url_for('main.donation') }}">支持</a>
                        {% if donation_config and donation_config.show_ranking %}
                        <a class="dropdown-item" href="{{ url_for('main.donation_ranking') }}">排行榜</a>
                        {% endif %}
                    </div>
                </div>
                
                {% if current_user.is_authenticated %}
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-toggle">{{ current_user.username }}</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="{{ url_for('main.change_password_page') }}">修改密码</a>
                        <a class="dropdown-item" href="{{ url_for('main.change_email_page') }}">修改邮箱</a>
                        {% if current_user.is_admin %}
                        <a class="dropdown-item" href="{{ url_for('admin.index') }}">管理员后台</a>
                        {% endif %}
                        <a class="dropdown-item danger" href="{{ url_for('auth.delete_account') }}">注销账户</a>
                        <a class="dropdown-item" href="{{ url_for('auth.logout') }}">退出登录</a>
                    </div>
                </div>
                {% else %}
                <a href="{{ url_for('auth.login') }}" class="nav-link">登录</a>
                <a href="{{ url_for('auth.register') }}" class="nav-link">注册</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <div class="container mt-4">
        <!-- Flash消息显示 -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category if category != 'message' else 'info' }} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <!-- 页面内容 -->
        {% block page_content %}{% endblock %}
    </div>

    <!-- 页脚 -->
    {% block footer %}
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="{{ url_for('main.about') }}">关于我们</a>
                <a href="{{ url_for('main.guide') }}">使用指南</a>
                <a href="{{ url_for('main.donation') }}">支持项目</a>
                <a href="#">隐私政策</a>
                <a href="#">服务条款</a>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 {{ project_name }}. 保留所有权利。</p>
            </div>
        </div>
    </footer>
    {% endblock %}

    <!-- 导航栏交互脚本 -->
    <script>
    // 导航菜单控制
    document.addEventListener('DOMContentLoaded', function() {
        const navToggle = document.getElementById('navToggle');
        const navMenu = document.getElementById('navMenu');
        
        if (navToggle && navMenu) {
            navToggle.addEventListener('click', function() {
                navToggle.classList.toggle('active');
                navMenu.classList.toggle('active');
            });
            
            // 处理下拉菜单点击事件
            const dropdownToggles = navMenu.querySelectorAll('.dropdown-toggle');
            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const dropdown = this.parentElement;
                    const isActive = dropdown.classList.contains('active');
                    
                    // 关闭所有其他下拉菜单
                    document.querySelectorAll('.nav-dropdown').forEach(item => {
                        item.classList.remove('active');
                        const toggleBtn = item.querySelector('.dropdown-toggle');
                        if (toggleBtn) {
                            toggleBtn.classList.remove('active');
                        }
                    });
                    
                    // 切换当前下拉菜单
                    if (!isActive) {
                        dropdown.classList.add('active');
                        this.classList.add('active');
                    }
                });
            });
            
            // 点击菜单项后关闭菜单
            const navLinks = navMenu.querySelectorAll('.nav-link:not(.dropdown-toggle), .dropdown-item');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    navToggle.classList.remove('active');
                    navMenu.classList.remove('active');
                    // 关闭所有下拉菜单
                    document.querySelectorAll('.nav-dropdown').forEach(item => {
                        item.classList.remove('active');
                        const toggleBtn = item.querySelector('.dropdown-toggle');
                        if (toggleBtn) {
                            toggleBtn.classList.remove('active');
                        }
                    });
                });
            });
            
            // 点击页面其他地方关闭菜单
            document.addEventListener('click', function(e) {
                if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
                    navToggle.classList.remove('active');
                    navMenu.classList.remove('active');
                    // 关闭所有下拉菜单
                    document.querySelectorAll('.nav-dropdown').forEach(item => {
                        item.classList.remove('active');
                        const toggleBtn = item.querySelector('.dropdown-toggle');
                        if (toggleBtn) {
                            toggleBtn.classList.remove('active');
                        }
                    });
                }
            });
            
            // 窗口大小改变时重置下拉菜单状态
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    document.querySelectorAll('.dropdown-menu').forEach(menu => {
                        menu.style.display = '';
                    });
                }
            });
        }
    });
    
    // VIP提示功能
    function showVipRequiredAlert(event) {
        event.preventDefault();
        alert('此功能需要VIP权限，请联系管理员开通VIP服务。');
    }
    
    // 简单的moment函数替代
    function moment(dateString) {
        const date = dateString ? new Date(dateString) : new Date();
        return {
            format: function(formatStr) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                const seconds = String(date.getSeconds()).padStart(2, '0');
                
                if (formatStr === 'YYYY-MM-DD HH:mm:ss') {
                    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                } else if (formatStr === 'MM-DD HH:mm:ss') {
                    return `${month}-${day} ${hours}:${minutes}:${seconds}`;
                } else if (formatStr === 'YYYY') {
                    return `${year}`;
                }
                return date.toISOString();
            }
        };
    }
    </script>
    
    <!-- 页面特定JavaScript -->
    {% block page_scripts %}{% endblock %}
</body>
</html>